<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/GridapOffshore.jl/libs/katex/katex.min.css"> <link rel=stylesheet  href="/GridapOffshore.jl/libs/highlight/github.min.css"> <link href="/GridapOffshore.jl/css/franklin.css" rel=stylesheet > <link href="/GridapOffshore.jl/css/vela.css" rel=stylesheet > <script src="/GridapOffshore.jl/libs/vela/jquery.min.js"></script> <link rel=icon  href="/GridapOffshore.jl/assets/favicon.png"> <title>Franklin Example | Vela</title> <div class="main-nav slideout-menu slideout-menu-left" id=menu > <div class=flex-container > <span class=sidebar-brand > <h3 style='font-size: 25px'>Gridap Offshore</h3> </span> </div> <nav class=sidebar-nav > <ul class=metismenu  id=metismenu  > <li><a href="/GridapOffshore.jl/index.html">Home</a> <li><a href="" class=has-arrow >Theory</a> <ul> <li><a href="/GridapOffshore.jl/Theory/tutorial_1/intro_FE_1D">1. Solving PDEs with Gridap</a> <li><a href="/GridapOffshore.jl/Theory/tutorial_EulerBernoulli/euler_bernoulli">2. Solving the Euler-Bernoulli beam equation with C/DG FE</a> <li><a href="/GridapOffshore.jl/Theory/tutorial_Timoshenko/Timoshenko">3. Solving the Timoshenko beam equation</a> </ul> <li><a href="" class=has-arrow >MSc thesis</a> <ul> <li><a href="" class=has-arrow >Floating structures</a> <ul> <li><a href="/GridapOffshore.jl/MSc_thesis/Floating/2021_S_van_Hoof/VFFS">S. van Hoof, 2021</a> <li><a href="/GridapOffshore.jl/MSc_thesis/Floating/2021_D_Regout/VLFS">D. Regout, 2021</a> </ul> <li><a href="" class=has-arrow >Porous media</a> <ul> <li><a href="/GridapOffshore.jl/MSc_thesis/Porous/2022_J_Ruesen/porous">J. Ruesen, 2022</a> </ul> </ul> </ul> </nav> </div> <main id=panel  class="slidout-panel slideout-panel-left"> <div class="toggle-button hamburger hamburger--spin"> <div class=hamburger-box > <div class=hamburger-inner ></div> </div> </div> <h1 class="page title">Flow through porous zone</h1> <hr> <div class=franklin-content ><p><em>Authors:</em> <em><a href="https://github.com/joeljulian">Joël Ruesen</a> and <a href="https://github.com/oriolcg">Oriol Colomés Gené</a></em></p> <p><em>Published:</em> January 2022</p> <p><em>Gridap version:</em> <a href="https://github.com/gridap/Gridap.jl/tree/release-0.16">Gridap@0.16.5</a></p> <p>This tutorial shows how wave-progression through a porous medium is modelled. The model uses viscous incompressible Navier Stokes in combination with Darcy-Forchheimer resistance terms in the momentum balance, implemented using the Gridap library.</p> <div class=franklin-toc ><ol><li><a href="#problem_statement">Problem statement</a><li><a href="#mathematical_formulation">Mathematical formulation</a><ol><li><a href="#governing_equations">Governing equations</a><li><a href="#boundary_conditions">Boundary conditions</a></ol><li><a href="#numerical_model">Numerical model</a><ol><li><a href="#input_variables">Input variables</a><li><a href="#domain">Domain</a><li><a href="#fe_spaces">FE Spaces</a><li><a href="#weak_form">Weak form</a><li><a href="#solver">Solver</a><li><a href="#plotting">Plotting</a></ol><li><a href="#workflow_tools">Workflow tools</a><ol><li><a href="#research_project_structuring">Research project structuring</a><li><a href="#simulating_in_batches">Simulating in batches</a><li><a href="#timing_outputs">Timing outputs</a></ol></ol></div> <h1 id=problem_statement ><a href="#problem_statement" class=header-anchor >Problem statement</a></h1> <p>Large-scale offshore kelp farms have the beneficial side-effect that they can be used for coastal protection, increasing workability, and potentially reduce design requirements regarding fatigue life. All of this is possible through the wave damping potential of densely seeded grow lines or nets in seaweed cultivation areas.</p> <p>Wave height reduction over a vegetated area is due to the dissipation of wave energy. Different methodologies exist to capture this problem in a model. Some models are able to capture even individual plant dynamics, they are computationally way too expensive for modelling on a farm scale. Other methods rely on calibrating a bulk drag coefficient, which captures the effects for a limited range of conditions and vegetation characteristics. </p> <p>The following model generalizes the complex geometry on a small scale by approaching the farm as a porous medium. Hereby, the effect of the kelp on incident waves can be modelled through a porous medium, described by the Darcy-Forchheimer resistance terms in the momentum equation.</p> <h1 id=mathematical_formulation ><a href="#mathematical_formulation" class=header-anchor >Mathematical formulation</a></h1> <p>Navier Stokes for visous incompressible flow, derived from the Cauchy momentum equation. Under the assumption of conservtion of mass and the resulting mass continuity equation this eventually reduces to:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mtable rowspacing=0.2500em  columnalign=right  columnspacing=""><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mi>ρ</mi><mrow><mo fence=true >(</mo><mfrac><mrow><mi mathvariant=normal >∂</mi><mi mathvariant=bold >u</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>t</mi></mrow></mfrac><mo>+</mo><mi mathvariant=bold >u</mi><mo>⋅</mo><mi mathvariant=normal >∇</mi><mi mathvariant=bold >u</mi><mo fence=true >)</mo></mrow><mo>−</mo><mi>μ</mi><mi mathvariant=normal >Δ</mi><mi mathvariant=bold >u</mi><mo>+</mo><mi mathvariant=normal >∇</mi><mi>p</mi><mo>=</mo><mi mathvariant=bold >f</mi><mspace width=1em /><mtext> on </mtext><mi mathvariant=normal >Ω</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mi mathvariant=normal >∇</mi><mo>⋅</mo><mi mathvariant=bold >u</mi><mo>=</mo><mn>0</mn><mspace width=1em /><mtext> on </mtext><mi mathvariant=normal >Ω</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex"> % %\begin{equation} \begin{split} \rho \left ( \frac{\partial \mathbf{u}}{\partial t} +\mathbf{u} \cdot \nabla \mathbf{u} \right ) -\mu \Delta \mathbf{u}+\nabla p=\mathbf{f} \quad \text{ on } \Omega \\ \nabla \cdot \mathbf{u}=0 \quad \text{ on } \Omega \end{split} % %\end{equation} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:4.20003em;vertical-align:-1.850015em;"></span><span class=mord ><span class=mtable ><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.350015em;"><span style="top:-4.350015000000001em;"><span class=pstrut  style="height:3.45em;"></span><span class=mord ><span class="mord mathnormal">ρ</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathbf">u</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathbf">u</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >⋅</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >∇</span><span class="mord mathbf">u</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">μ</span><span class=mord >Δ</span><span class="mord mathbf">u</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >∇</span><span class="mord mathnormal">p</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class="mord mathbf" style="margin-right:0.10903em;">f</span><span class=mspace  style="margin-right:1em;"></span><span class="mord text"><span class=mord > on </span></span><span class=mord >Ω</span></span></span><span style="top:-2.2599850000000004em;"><span class=pstrut  style="height:3.45em;"></span><span class=mord ><span class=mord >∇</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >⋅</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathbf">u</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mord >0</span><span class=mspace  style="margin-right:1em;"></span><span class="mord text"><span class=mord > on </span></span><span class=mord >Ω</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.850015em;"><span></span></span></span></span></span></span></span></span></span></span></span> <h2 id=governing_equations ><a href="#governing_equations" class=header-anchor >Governing equations</a></h2> <p>The original Navier Stokes equations are elaborated with Darcy Forchheimer terms that are linear and quadratic with velocity:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mtable rowspacing=0.2500em  columnalign=right  columnspacing=""><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><munder><munder><mfrac><mrow><mi mathvariant=normal >∂</mi><mi mathvariant=bold >u</mi></mrow><mrow><mi mathvariant=normal >∂</mi><mi>t</mi></mrow></mfrac><mo stretchy=true >⏟</mo></munder><mtext>Velocity change</mtext></munder><mo>+</mo><munder><munder><mrow><mi mathvariant=bold >u</mi><mo>⋅</mo><mi mathvariant=normal >∇</mi><mi mathvariant=bold >u</mi></mrow><mo stretchy=true >⏟</mo></munder><mtext>Convection</mtext></munder><mo>−</mo><munder><munder><mrow><mi>ν</mi><mi mathvariant=normal >Δ</mi><mi mathvariant=bold >u</mi></mrow><mo stretchy=true >⏟</mo></munder><mtext>Diffusion</mtext></munder><mo>+</mo><munder><munder><mrow><mi mathvariant=normal >∇</mi><msup><mi>p</mi><mo>∗</mo></msup></mrow><mo stretchy=true >⏟</mo></munder><mtext>Pressure gradient</mtext></munder><mo>=</mo><mi mathvariant=bold >f</mi><mi mathvariant=normal >/</mi><mi>ρ</mi><mspace width=1em /><mtext> on </mtext><mi mathvariant=normal >Ω</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mtext>where </mtext><mspace width=1em /><mi mathvariant=bold >f</mi><mi mathvariant=normal >/</mi><mi>ρ</mi><mo>=</mo><munder><munder><mrow><mi>α</mi><mi mathvariant=bold >u</mi><mo>+</mo><mi>β</mi><msup><mi mathvariant=bold >u</mi><mn>2</mn></msup></mrow><mo stretchy=true >⏟</mo></munder><mtext>Darcy-Forchheimer resistance</mtext></munder><mo>+</mo><munder><munder><mi mathvariant=bold >g</mi><mo stretchy=true >⏟</mo></munder><mtext>Gravity</mtext></munder><mspace width=1em /><mspace width=1em /><mspace width=1em /><mspace width=1em /></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mi mathvariant=normal >∇</mi><mo>⋅</mo><mi mathvariant=bold >u</mi><mo>=</mo><mn>0</mn><mspace width=1em /><mtext> on </mtext><mi mathvariant=normal >Ω</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex"> % %\begin{equation} \begin{split} \underbrace{\frac{\partial \mathbf{u}}{\partial t}}_{\text{Velocity change}} + \underbrace{\mathbf{u} \cdot \nabla \mathbf{u}}_{\text{Convection}} - \underbrace{\nu \Delta \mathbf{u}}_{\text{Diffusion}}+\underbrace{\nabla p^*}_{\text{Pressure gradient}}= \mathbf{f}/\rho \quad \text{ on } \Omega \\ \text{where } \quad \mathbf{f}/\rho = \underbrace{ \alpha \mathbf{u} + \beta \mathbf{u}^2 }_{\text{Darcy-Forchheimer resistance}}+ \underbrace{\mathbf{g}}_{\text{Gravity}} \quad \quad \quad \quad \\ \nabla \cdot \mathbf{u}=0 \quad \text{ on } \Omega \\ \end{split} % %\end{equation} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:8.15642em;vertical-align:-3.8282099999999994em;"></span><span class=mord ><span class=mtable ><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:4.32821em;"><span style="top:-6.32821em;"><span class=pstrut  style="height:3.3714399999999998em;"></span><span class=mord ><span class="mord munder"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-1.351332em;"><span class=pstrut  style="height:3.37144em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Velocity change</span></span></span></span></span><span style="top:-3.37144em;"><span class=pstrut  style="height:3.37144em;"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3714400000000002em;"><span class=svg-align  style="top:-2.0374399999999997em;"><span class=pstrut  style="height:3.3714399999999998em;"></span><span class=stretchy  style="height:0.548em;min-width:1.6em;"><span class=brace-left  style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMinYMin slice'><path d='M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7 -331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z'/></svg></span><span class=brace-center  style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMidYMin slice'><path d='M199572 214 c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0 -5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z'/></svg></span><span class=brace-right  style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMaxYMin slice'><path d='M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237 -174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z'/></svg></span></span></span><span style="top:-3.3714399999999998em;"><span class=pstrut  style="height:3.3714399999999998em;"></span><span class=mord ><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class="mord mathbf">u</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.334em;"><span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.156216em;"><span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.6833299999999998em;"><span style="top:-1.6736689999999999em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Convection</span></span></span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.68333em;"><span class=svg-align  style="top:-2.352em;"><span class=pstrut  style="height:3em;"></span><span class=stretchy  style="height:0.548em;min-width:1.6em;"><span class=brace-left  style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMinYMin slice'><path d='M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7 -331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z'/></svg></span><span class=brace-center  style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMidYMin slice'><path d='M199572 214 c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0 -5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z'/></svg></span><span class=brace-right  style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMaxYMin slice'><path d='M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237 -174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z'/></svg></span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathbf">u</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >⋅</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >∇</span><span class="mord mathbf">u</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.648em;"><span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.3263310000000001em;"><span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.6833299999999998em;"><span style="top:-1.665892em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Diffusion</span></span></span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.68333em;"><span class=svg-align  style="top:-2.352em;"><span class=pstrut  style="height:3em;"></span><span class=stretchy  style="height:0.548em;min-width:1.6em;"><span class=brace-left  style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMinYMin slice'><path d='M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7 -331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z'/></svg></span><span class=brace-center  style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMidYMin slice'><path d='M199572 214 c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0 -5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z'/></svg></span><span class=brace-right  style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMaxYMin slice'><path d='M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237 -174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z'/></svg></span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.06366em;">ν</span><span class=mord >Δ</span><span class="mord mathbf">u</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.648em;"><span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.334108em;"><span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.7386959999999998em;"><span style="top:-1.471452em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Pressure gradient</span></span></span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.7386959999999999em;"><span class=svg-align  style="top:-2.15756em;"><span class=pstrut  style="height:3em;"></span><span class=stretchy  style="height:0.548em;min-width:1.6em;"><span class=brace-left  style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMinYMin slice'><path d='M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7 -331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z'/></svg></span><span class=brace-center  style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMidYMin slice'><path d='M199572 214 c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0 -5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z'/></svg></span><span class=brace-right  style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMaxYMin slice'><path d='M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237 -174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z'/></svg></span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >∇</span><span class=mord ><span class="mord mathnormal">p</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.738696em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.8424400000000001em;"><span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.664656em;"><span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class="mord mathbf" style="margin-right:0.10903em;">f</span><span class=mord >/</span><span class="mord mathnormal">ρ</span><span class=mspace  style="margin-right:1em;"></span><span class="mord text"><span class=mord > on </span></span><span class=mord >Ω</span></span></span><span style="top:-3.007886em;"><span class=pstrut  style="height:3.3714399999999998em;"></span><span class=mord ><span class="mord text"><span class=mord >where </span></span><span class=mspace  style="margin-right:1em;"></span><span class="mord mathbf" style="margin-right:0.10903em;">f</span><span class=mord >/</span><span class="mord mathnormal">ρ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8641079999999997em;"><span style="top:-1.471452em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Darcy-Forchheimer resistance</span></span></span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8641079999999998em;"><span class=svg-align  style="top:-2.15756em;"><span class=pstrut  style="height:3em;"></span><span class=stretchy  style="height:0.548em;min-width:1.6em;"><span class=brace-left  style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMinYMin slice'><path d='M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7 -331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z'/></svg></span><span class=brace-center  style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMidYMin slice'><path d='M199572 214 c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0 -5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z'/></svg></span><span class=brace-right  style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMaxYMin slice'><path d='M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237 -174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z'/></svg></span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mord mathbf">u</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class=mord ><span class="mord mathbf">u</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.8424400000000001em;"><span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.664656em;"><span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.44444000000000017em;"><span style="top:-1.4792290000000001em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Gravity</span></span></span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.44443999999999995em;"><span class=svg-align  style="top:-2.15756em;"><span class=pstrut  style="height:3em;"></span><span class=stretchy  style="height:0.548em;min-width:1.6em;"><span class=brace-left  style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMinYMin slice'><path d='M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7 -331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z'/></svg></span><span class=brace-center  style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMidYMin slice'><path d='M199572 214 c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0 -5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z'/></svg></span><span class=brace-right  style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMaxYMin slice'><path d='M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237 -174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z'/></svg></span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathbf" style="margin-right:0.01597em;">g</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.8424400000000001em;"><span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.6568789999999998em;"><span></span></span></span></span></span><span class=mspace  style="margin-right:1em;"></span><span class=mspace  style="margin-right:1em;"></span><span class=mspace  style="margin-right:1em;"></span><span class=mspace  style="margin-right:1em;"></span></span></span><span style="top:-0.20323000000000047em;"><span class=pstrut  style="height:3.3714399999999998em;"></span><span class=mord ><span class=mord >∇</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >⋅</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathbf">u</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mord >0</span><span class=mspace  style="margin-right:1em;"></span><span class="mord text"><span class=mord > on </span></span><span class=mord >Ω</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:3.8282099999999994em;"><span></span></span></span></span></span></span></span></span></span></span></span> <h2 id=boundary_conditions ><a href="#boundary_conditions" class=header-anchor >Boundary conditions</a></h2> <h3 id=wave_generation ><a href="#wave_generation" class=header-anchor >Wave generation</a></h3> <p>Based upon linear wave theory, wave generation is provided through the following velocity components:</p> <a id=eqparticle_velocity  class=anchor ></a><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mtable rowspacing=0.2500em  columnalign="right left" columnspacing=0em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><msub><mi>u</mi><mtext>hor</mtext></msub><mo stretchy=false >(</mo><mi>x</mi><mo separator=true >,</mo><mi>y</mi><mo separator=true >,</mo><mi>t</mi><mo stretchy=false >)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>=</mo><msub><mi>a</mi><mi>i</mi></msub><msub><mi>ω</mi><mi>i</mi></msub><mfrac><mrow><mi>cosh</mi><mo>⁡</mo><mrow><mo stretchy=false >(</mo><msub><mi>k</mi><mi>i</mi></msub><mi>y</mi><mo stretchy=false >)</mo></mrow></mrow><mrow><mi>sinh</mi><mo>⁡</mo><mrow><mo stretchy=false >(</mo><msub><mi>k</mi><mi>i</mi></msub><msub><mi>d</mi><mtext>water</mtext></msub><mo stretchy=false >)</mo></mrow></mrow></mfrac><mi>sin</mi><mo>⁡</mo><mo stretchy=false >(</mo><msub><mi>k</mi><mi>i</mi></msub><mi>x</mi><mo>−</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>t</mi><mo>−</mo><msub><mi>θ</mi><mi>i</mi></msub><mo stretchy=false >)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><msub><mi>u</mi><mtext>ver</mtext></msub><mo stretchy=false >(</mo><mi>x</mi><mo separator=true >,</mo><mi>y</mi><mo separator=true >,</mo><mi>t</mi><mo stretchy=false >)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>=</mo><msub><mi>a</mi><mi>i</mi></msub><msub><mi>ω</mi><mi>i</mi></msub><mfrac><mrow><mi>sinh</mi><mo>⁡</mo><mrow><mo stretchy=false >(</mo><msub><mi>k</mi><mi>i</mi></msub><mi>y</mi><mo stretchy=false >)</mo></mrow></mrow><mrow><mi>sinh</mi><mo>⁡</mo><mrow><mo stretchy=false >(</mo><msub><mi>k</mi><mi>i</mi></msub><msub><mi>d</mi><mtext>water</mtext></msub><mo stretchy=false >)</mo></mrow></mrow></mfrac><mi>cos</mi><mo>⁡</mo><mo stretchy=false >(</mo><msub><mi>k</mi><mi>i</mi></msub><mi>x</mi><mo>−</mo><msub><mi>ω</mi><mi>i</mi></msub><mi>t</mi><mo>−</mo><msub><mi>θ</mi><mi>i</mi></msub><mo stretchy=false >)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex"> % %\begin{equation} \begin{split} u_{\text{hor}} (x,y,t) &amp;= a_i \omega_i \frac{\cosh{(k_i y)}}{\sinh{(k_i d_{\text{water}})}} \sin(k_i x - \omega_i t - \theta_i)\\ u_{\text{ver}} (x,y,t) &amp;= a_i \omega_i \frac{\sinh{(k_i y)}}{\sinh{(k_i d_{\text{water}})}} \cos(k_i x - \omega_i t - \theta_i) \end{split} % %\end{equation} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:5.3260000000000005em;vertical-align:-2.4130000000000003em;"></span><span class=mord ><span class=mtable ><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.9130000000000003em;"><span style="top:-4.913em;"><span class=pstrut  style="height:3.427em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">u</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">hor</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mopen >(</span><span class="mord mathnormal">x</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">t</span><span class=mclose >)</span></span></span><span style="top:-2.25em;"><span class=pstrut  style="height:3.427em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">u</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">ver</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mopen >(</span><span class="mord mathnormal">x</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">t</span><span class=mclose >)</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.4130000000000003em;"><span></span></span></span></span></span><span class=col-align-l ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.9130000000000003em;"><span style="top:-4.913em;"><span class=pstrut  style="height:3.427em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mord ><span class="mord mathnormal">a</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">ω</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.427em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mop >sinh</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">d</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">water</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mop >cosh</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >)</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mop >sin</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">x</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">ω</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">t</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span><span style="top:-2.25em;"><span class=pstrut  style="height:3.427em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mord ><span class="mord mathnormal">a</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">ω</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.427em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mop >sinh</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">d</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">water</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mop >sinh</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mclose >)</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mop >cos</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">x</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">ω</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">t</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.4130000000000003em;"><span></span></span></span></span></span></span></span></span></span></span></span> <h3 id=free_surface ><a href="#free_surface" class=header-anchor >Free surface</a></h3> <p>The model remains single-phase and the free surface is defined through a linearized transpiration boundary condition, much like the one for Airy wave theory: <img style="display: block;max-width: 40%;height: auto;margin: auto;float: none!important;" src="/GridapOffshore.jl/Fluids\Porous/img/BC_fs.PNG" alt="Domain model" width="50%" /><center><i>Linearized transpiration boundary condition</i></center></p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mtable rowspacing=0.2500em  columnalign="right left" columnspacing=0em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><msub><mi>σ</mi><mtext>fluid</mtext></msub></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>=</mo><msub><mi>τ</mi><mtext>s,v</mtext></msub><mo>−</mo><mi>p</mi><mi>I</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>=</mo><mn>2</mn><mi>μ</mi><mi>ε</mi><mo stretchy=false >(</mo><mi mathvariant=bold >u</mi><mo stretchy=false >)</mo><mo>−</mo><mi>p</mi><mi>I</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex"> %\begin{equation} \begin{split} \sigma_\text{fluid} &amp;= \tau_\text{s,v} - p I\\ &amp;= 2 \mu \varepsilon(\mathbf{u}) - p I \end{split} %\end{equation} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:3.0000000000000004em;vertical-align:-1.2500000000000002em;"></span><span class=mord ><span class=mtable ><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.7500000000000002em;"><span style="top:-3.91em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">fluid</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class=pstrut  style="height:3em;"></span><span class=mord ></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.2500000000000002em;"><span></span></span></span></span></span><span class=col-align-l ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.7500000000000002em;"><span style="top:-3.91em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.1132em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">s,v</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span><span style="top:-2.41em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mord >2</span><span class="mord mathnormal">μ</span><span class="mord mathnormal">ε</span><span class=mopen >(</span><span class="mord mathbf">u</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.2500000000000002em;"><span></span></span></span></span></span></span></span></span></span></span></span> <p>And for air</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mtable rowspacing=0.2500em  columnalign="right left" columnspacing=0em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><msub><mi>σ</mi><mtext>air</mtext></msub></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>=</mo><msub><mi>p</mi><mtext>atm</mtext></msub><mo>+</mo><msub><mi>ρ</mi><mtext>fluid</mtext></msub><mi>g</mi><mi>η</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex"> %\begin{equation} \begin{split} \sigma_\text{air} &amp;= p_{\text{atm}} + \rho_{\text{fluid}} g \eta \end{split} %\end{equation} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.5000000000000002em;vertical-align:-0.5000000000000002em;"></span><span class=mord ><span class=mtable ><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1em;"><span style="top:-3.16em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31750199999999995em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">air</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.5000000000000002em;"><span></span></span></span></span></span><span class=col-align-l ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1em;"><span style="top:-3.16em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mord ><span class="mord mathnormal">p</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">atm</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathnormal">ρ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">fluid</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal" style="margin-right:0.03588em;">η</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.5000000000000002em;"><span></span></span></span></span></span></span></span></span></span></span></span> <p>Plugging the stresses above into the traction equilibrium, the formulation is found that can be implemented in the weak form in the model.</p> <a id=eqfs_bc_dyn  class=anchor ></a><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mtable rowspacing=0.2500em  columnalign="right left" columnspacing=0em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><msub><mi>τ</mi><mtext>fluid</mtext></msub></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>=</mo><msub><mi>τ</mi><mtext>air</mtext></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mo>−</mo><mo stretchy=false >(</mo><msub><mi>σ</mi><mtext>fluid</mtext></msub><mo stretchy=false >)</mo><msub><mi>n</mi><mtext>fa</mtext></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>=</mo><msub><mi>σ</mi><mtext>air</mtext></msub><msub><mi>n</mi><mtext>fa</mtext></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mo>−</mo><mo stretchy=false >(</mo><mn>2</mn><mi>μ</mi><mi>ε</mi><mo stretchy=false >(</mo><mi mathvariant=bold >u</mi><mo stretchy=false >)</mo><mo>−</mo><mi>p</mi><mi>I</mi><mo stretchy=false >)</mo><msub><mi>n</mi><mtext>fa</mtext></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>=</mo><mo stretchy=false >(</mo><msub><mi>p</mi><mtext>atm</mtext></msub><mo>+</mo><msub><mi>ρ</mi><mtext>fluid</mtext></msub><mi>g</mi><mi>η</mi><mo stretchy=false >)</mo><msub><mi>n</mi><mtext>fa</mtext></msub></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex"> %\begin{equation} \begin{split} \tau_{\text{fluid}} &amp;= \tau_{\text{air}} \\ -(\sigma_{\text{fluid}}) n_{\text{fa}} &amp;= \sigma_{\text{air}} n_{\text{fa}} \\ -(2 \mu \varepsilon(\mathbf{u}) - p I) n_{\text{fa}} &amp;= (p_{\text{atm}} + \rho_{\text{fluid}} g \eta) n_{\text{fa}} \\ \end{split} %\end{equation} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:4.500000000000002em;vertical-align:-2.000000000000001em;"></span><span class=mord ><span class=mtable ><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.5000000000000004em;"><span style="top:-4.66em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.1132em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">fluid</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.16em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >−</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">fluid</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class=mord ><span class="mord mathnormal">n</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">fa</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.6599999999999993em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >−</span><span class=mopen >(</span><span class=mord >2</span><span class="mord mathnormal">μ</span><span class="mord mathnormal">ε</span><span class=mopen >(</span><span class="mord mathbf">u</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class=mclose >)</span><span class=mord ><span class="mord mathnormal">n</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">fa</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.000000000000001em;"><span></span></span></span></span></span><span class=col-align-l ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.5000000000000004em;"><span style="top:-4.66em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.1132em;">τ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31750199999999995em;"><span style="top:-2.5500000000000003em;margin-left:-0.1132em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">air</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.16em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31750199999999995em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">air</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">n</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">fa</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.6599999999999993em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal">p</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">atm</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathnormal">ρ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">fluid</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal" style="margin-right:0.03588em;">η</span><span class=mclose >)</span><span class=mord ><span class="mord mathnormal">n</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">fa</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.000000000000001em;"><span></span></span></span></span></span></span></span></span></span></span></span> <h1 id=numerical_model ><a href="#numerical_model" class=header-anchor >Numerical model</a></h1> <p>The mathematical equations posed above are captured in a numerical scheme to be able to simulate the resulting system. The structure of the numerical method, with all components needed to arrive at a solution is presented below.</p> <img style="display: block;max-width: 150%;height: auto;margin: auto;float: none!important;" src="/GridapOffshore.jl/Fluids\Porous/img/structure_code.PNG" alt="Domain model" width="100%" /><center><i>Structure of numerical components</i></center> <p>Before setting up and code, all packages are called to include their functions in the following code.</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> DrWatson
<span class=hljs-meta >@quickactivate</span> <span class=hljs-string >&quot;PorousMediumFlow&quot;</span>
<span class=hljs-comment ># Load packages</span>
<span class=hljs-keyword >using</span> Gridap
<span class=hljs-keyword >using</span> Gridap.Geometry
<span class=hljs-keyword >using</span> GridapODEs
<span class=hljs-keyword >using</span> GridapODEs.ODETools
<span class=hljs-keyword >using</span> GridapODEs.TransientFETools
<span class=hljs-keyword >using</span> LineSearches: BackTracking
<span class=hljs-keyword >using</span> WriteVTK
<span class=hljs-keyword >using</span> LinearAlgebra
<span class=hljs-keyword >using</span> DelimitedFiles, FileIO, Dates
<span class=hljs-keyword >using</span> JLD2, DataFrames, TimerOutputs
<span class=hljs-keyword >using</span> IncompleteLU, IterativeSolvers
include(<span class=hljs-string >&quot;LinearSolvers.jl&quot;</span>)</code></pre> <h2 id=input_variables ><a href="#input_variables" class=header-anchor >Input variables</a></h2> <p>The constants that remain the same for each simulation and thus do not need to be user-defined are defined first. Additionally, the variables that are direct functions of the input variables can be stated already.</p> <pre><code class="julia hljs"><span class=hljs-comment >## Establish constants:</span>
    theta = <span class=hljs-number >0.5</span>      
    g = <span class=hljs-number >9.81</span>
    n_z = VectorValue(<span class=hljs-number >0.0</span>,<span class=hljs-number >1.0</span>)
    ρ = <span class=hljs-number >1025.0</span>
    p_atm = (<span class=hljs-number >1.013</span>*<span class=hljs-number >10</span>^<span class=hljs-number >5</span>)/ρ
    ν =  <span class=hljs-number >0.001</span>/ρ
    f_g = VectorValue(<span class=hljs-number >0.0</span>, -g)

    λ_in = g*(T_in^<span class=hljs-number >2</span>)/(<span class=hljs-number >2</span>*<span class=hljs-literal >π</span>)
    k_in = <span class=hljs-number >2</span>*<span class=hljs-literal >π</span>/λ_in
    ω_in  = sqrt(g*k_in) 

    <span class=hljs-comment >## Geometry and meshing</span>
    dampinback = length_damp
    dampoutfront = length_tank-length_damp
    dampoutback = length_tank
    n = cellm*length_tank
    m = (cellm)*depth_tank    
    h_cell = <span class=hljs-number >1</span>/cellm
    dampinfront = <span class=hljs-number >0.0</span>
    vegbottom = vegtop-vegheight
    vegback = vegfront+veglength

    <span class=hljs-comment >## Alternatively, dimensions can be parameterized</span>
    <span class=hljs-comment ># vegfront = round(λ_in, digits = 1, base = 5)</span>
    <span class=hljs-comment ># length_tank = round(10*λ_in, digits = 1, base =5)</span>
    <span class=hljs-comment ># veglength = round(4*λ_in, digits = 1, base =5)</span>
    <span class=hljs-comment ># length_damp = round(4*λ_in, digits = 1, base =5)</span></code></pre> <h2 id=domain ><a href="#domain" class=header-anchor >Domain</a></h2> <p>The equations stated above are impemented onto the domain. The model essentially makes use of a stationary, evenly-spaced mesh, but <em>Gridap</em> allows for more complex definitions as well.</p> <pre><code class="julia hljs"><span class=hljs-comment >## Domain and model set-up</span>
    domain = (<span class=hljs-number >0</span>,length_tank,<span class=hljs-number >0</span>,depth_tank)
    partition = (n,m)
    model = CartesianDiscreteModel(domain,partition)
    writevtk(model,model_dir*<span class=hljs-string >&quot;\\<span class=hljs-variable >$runname</span> _domain&quot;</span>)

    k = <span class=hljs-number >2</span>
    Ω = Triangulation(model)
    degree = <span class=hljs-number >2</span>*k
    dΩ = Measure(Ω,degree)

    labels = get_face_labeling(model)</code></pre> <h3 id=boundaries ><a href="#boundaries" class=header-anchor >Boundaries</a></h3> <p>The boundaries need to be defined &#40;and tagged&#41; in order to implement the boundary conditions on them later on.</p> <pre><code class="julia hljs">add_tag_from_tags!(labels,<span class=hljs-string >&quot;diri_in&quot;</span>,[<span class=hljs-number >3</span>,<span class=hljs-number >7</span>,])
    add_tag_from_tags!(labels,<span class=hljs-string >&quot;freesurf_in&quot;</span>,[<span class=hljs-number >3</span>,])
    add_tag_from_tags!(labels,<span class=hljs-string >&quot;free_surf&quot;</span>,[<span class=hljs-number >3</span>,<span class=hljs-number >4</span>,<span class=hljs-number >6</span>,])
    add_tag_from_tags!(labels,<span class=hljs-string >&quot;neum_out&quot;</span>,[<span class=hljs-number >4</span>,<span class=hljs-number >8</span>,])
    add_tag_from_tags!(labels,<span class=hljs-string >&quot;diri_wall&quot;</span>,[<span class=hljs-number >1</span>,<span class=hljs-number >2</span>,<span class=hljs-number >5</span>])

    <span class=hljs-comment >## Prepare free surface discrete model</span>
    bgface_to_mask = get_face_mask(labels,[<span class=hljs-number >6</span>],<span class=hljs-number >1</span>)
    Γface_to_bgface = findall(bgface_to_mask)
    model_Γ = BoundaryDiscreteModel(Polytope{<span class=hljs-number >1</span>},model,Γface_to_bgface)
    writevtk(model_Γ,model_dir*<span class=hljs-string >&quot;\\<span class=hljs-subst >$(runname)</span>_boundary&quot;</span>)

    Γ_fa = Triangulation(model_Γ)
    dΓ_fa = Measure(Γ_fa,degree)
    n_fa = get_normal_vector(Γ_fa)

    Γ_out = BoundaryTriangulation(model,tags=<span class=hljs-string >&quot;neum_out&quot;</span>)
    dΓ_out = Measure(Γ_out,degree)
    n_Γout = get_normal_vector(Γ_out)</code></pre> <h3 id=zones_within_domain ><a href="#zones_within_domain" class=header-anchor >Zones within domain</a></h3> <img style="display: block;max-width: 100%;height: auto;margin: auto;float: none!important;" src="/GridapOffshore.jl/Fluids\Porous/img/domain.PNG" alt="Domain model" width="75%" /><center><i>3D model</i></center> <p>For the damping zone and actual porous medium, where the porous parameters are activated, the coordinates must be specified:</p> <pre><code class="julia hljs"><span class=hljs-keyword >function</span> is_inveg(coords)
        midx = (coords[<span class=hljs-number >1</span>][<span class=hljs-number >1</span>] + coords[<span class=hljs-number >2</span>][<span class=hljs-number >1</span>])/<span class=hljs-number >2</span>
        midy = (coords[<span class=hljs-number >1</span>][<span class=hljs-number >2</span>] + coords[<span class=hljs-number >3</span>][<span class=hljs-number >2</span>])/<span class=hljs-number >2</span>
        midx &gt;= vegfront &amp;&amp; midx &lt;= vegback &amp;&amp; midy &lt;= vegtop &amp;&amp; midy &gt;= vegbottom
    <span class=hljs-keyword >end</span>

    <span class=hljs-keyword >function</span> is_indampout(coords)
        midx = (coords[<span class=hljs-number >1</span>][<span class=hljs-number >1</span>] + coords[<span class=hljs-number >2</span>][<span class=hljs-number >1</span>])/<span class=hljs-number >2</span>
        midy = (coords[<span class=hljs-number >1</span>][<span class=hljs-number >2</span>] + coords[<span class=hljs-number >3</span>][<span class=hljs-number >2</span>])/<span class=hljs-number >2</span>
        midx &gt;= dampoutfront &amp;&amp; midx &lt;= dampoutback
    <span class=hljs-keyword >end</span>

    oldcell_to_coods = get_cell_coordinates(Ω)
    oldcell_to_is_inveg = [lazy_map(is_inveg, oldcell_to_coods)[i] <span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:length(lazy_map(is_inveg, oldcell_to_coods))]
    oldcell_to_is_indampout = [lazy_map(is_indampout, oldcell_to_coods)[i] <span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:length(lazy_map(is_indampout, oldcell_to_coods))]
    incell_to_cellveg = findall(oldcell_to_is_inveg)
    incell_to_celldampout = findall(oldcell_to_is_indampout)
    outcell_to_cell = findall(iszero,(oldcell_to_is_inveg+ oldcell_to_is_indampin+ oldcell_to_is_indampout))

    model_veg = DiscreteModel(model,incell_to_cellveg)
    model_dampout = DiscreteModel(model,incell_to_celldampout)

    Ωveg = Triangulation(model_veg)
    dΩveg = Measure(Ωveg,degree)
    Ωdampout = Triangulation(model_dampout)
    dΩdampout = Measure(Ωdampout,degree)

    <span class=hljs-comment ># Vegetation parameters (currently user-defined in input)</span>
    α_veg = a_cons
    β_veg = b_cons

    <span class=hljs-comment ># Sponge damping zone</span>
    α_dampout(x::VectorValue) = C1*(<span class=hljs-number >1</span>-((depth_tank-x[<span class=hljs-number >2</span>])-depth_tank)/(depth_tank))*((x[<span class=hljs-number >1</span>]-(length_tank-length_damp))/(length_tank-length_damp))^<span class=hljs-number >2</span></code></pre> <h3 id=inflow_conditions ><a href="#inflow_conditions" class=header-anchor >Inflow conditions</a></h3> <p>As stated, wave generation is implemented by forcing particle velocity at the leftmost boundary. This is done using the orbital velocities as defined using Linear wave theory.</p> <pre><code class="julia hljs"><span class=hljs-comment ># #### Boundary conditions and porous zone</span>
    <span class=hljs-comment ># Velocity profile inlet</span>
    u_hor(x,t) = a_in*ω_in*((cosh(k_in*x[<span class=hljs-number >2</span>]))/(sinh(k_in*depth_tank)))*sin(x[<span class=hljs-number >1</span>]*k_in - ω_in*t - theta_in)
    u_ver(x,t) = a_in*ω_in*((sinh(k_in*x[<span class=hljs-number >2</span>]))/(sinh(k_in*depth_tank)))*cos(x[<span class=hljs-number >1</span>]*k_in - ω_in*t - theta_in)
   
    <span class=hljs-comment ># Boundary conditions at inlet and wall</span>
    u_in(x, t::<span class=hljs-built_in >Real</span>) = VectorValue(u_hor(x,t), u_ver(x,t))
    u_wall(x, t::<span class=hljs-built_in >Real</span>) = VectorValue(<span class=hljs-number >0.0</span>, <span class=hljs-number >0.0</span>)
    u₀(x, t::<span class=hljs-built_in >Real</span>) = VectorValue(<span class=hljs-number >0.0</span>,<span class=hljs-number >0.0</span>)
    <span class=hljs-comment >#u₀(x, t::Real) = VectorValue(a_in*ω_in*((cosh(k_in*x[2]))/(sinh(k_in*depth_tank))), 0.0)        #Initial conditions can be chosen</span>

    u_in(t::<span class=hljs-built_in >Real</span>) = x -&gt; u_in(x, t)
    u_wall(t::<span class=hljs-built_in >Real</span>) = x -&gt; u_wall(x, t)
    u₀(t::<span class=hljs-built_in >Real</span>) = x -&gt; u₀(x, t::<span class=hljs-built_in >Real</span>)</code></pre> <h2 id=fe_spaces ><a href="#fe_spaces" class=header-anchor >FE Spaces</a></h2> <p>The spaces are defined on which the functions will need to be found that provide the eventual solution fields. This is in line with the <a href="https://gridap.github.io/Tutorials/dev/">Gridap tutorials</a>. </p> <pre><code class="julia hljs"><span class=hljs-comment ># ## Numerical Scheme</span>
    <span class=hljs-comment ># Velocity FE space</span>
    reffeᵤ = ReferenceFE(lagrangian,VectorValue{<span class=hljs-number >2</span>,<span class=hljs-built_in >Float64</span>},k)
    V₀ = TestFESpace(model, reffeᵤ, conformity=:H1, dirichlet_tags=[<span class=hljs-string >&quot;diri_wall&quot;</span>, <span class=hljs-string >&quot;diri_in&quot;</span>])
    U = TransientTrialFESpace(V₀, [u_wall, u_in])

    <span class=hljs-comment ># Stabilization variable Space</span>
    reffe_s = ReferenceFE(lagrangian,VectorValue{<span class=hljs-number >2</span>,<span class=hljs-built_in >Float64</span>},k)
    S₀ = TestFESpace(model, reffe_s, conformity=:H1)
    S = TrialFESpace(S₀)

    <span class=hljs-comment ># Pressure FE space</span>
    reffe_p = ReferenceFE(lagrangian,<span class=hljs-built_in >Float64</span>,<span class=hljs-number >1</span>)
    Q = FESpace(model, reffe_p, conformity=:C0)
    P = TrialFESpace(Q)

    <span class=hljs-comment ># Free surface space</span>
    reffe_η = ReferenceFE(lagrangian,<span class=hljs-built_in >Float64</span>,k)
    Η₀ = TestFESpace(model_Γ, reffe_η, conformity=:H1) 
    Η = TrialFESpace(Η₀)

    <span class=hljs-comment ># Combining in multi-field</span>
    Y = MultiFieldFESpace([V₀,S₀,Q,Η₀])
    X = TransientMultiFieldFESpace([U,S,P,Η])</code></pre> <h2 id=weak_form ><a href="#weak_form" class=header-anchor >Weak form</a></h2> <p>Before going on to implementing the physics, some auxiliary functions are defined:</p> <pre><code class="julia hljs"><span class=hljs-meta >@timeit</span> timesave <span class=hljs-string >&quot;weak form setup&quot;</span> <span class=hljs-keyword >begin</span>
    nl_floor(u) = max((u⋅u).^(<span class=hljs-number >1</span>/<span class=hljs-number >2</span>), <span class=hljs-number >1e-10</span>)
    c₁    = <span class=hljs-number >12.0</span>*ρ           <span class=hljs-comment ># algorithmic constant (John,Kindl2007)</span>
    c₂    = <span class=hljs-number >2.0</span>
    ca    = c₁*ν/(h_cell^<span class=hljs-number >2</span>)  <span class=hljs-comment ># aux. constants</span>
    cb    = c₂/h_cell
    τₘ(u)       = <span class=hljs-number >1</span>/( ca + cb*((u⋅u).^(<span class=hljs-number >1</span>/<span class=hljs-number >2</span>)) )                                           <span class=hljs-comment ># Stabilization parameter (Colomes2016)</span>
    τlin(u,du)  = -((cb)/( (ca + cb*((u⋅u)^(<span class=hljs-number >1</span>/<span class=hljs-number >2</span>)) )^<span class=hljs-number >2</span>)) * ((<span class=hljs-number >1</span>/(nl_floor(u)))*(u⋅du))      <span class=hljs-comment ># Linearized stabilization parameter # u⋅du/nl_floor(u)</span>
    hN(x)       = VectorValue(p_atm + g*(depth_tank-x[<span class=hljs-number >2</span>]), <span class=hljs-number >0.0</span>)                          <span class=hljs-comment ># hydrostatic pressure</span></code></pre> <h3 id=weak_residual ><a href="#weak_residual" class=header-anchor >Weak Residual</a></h3> <p>The governing equations are captured through the weak form:</p> <pre><code class="julia hljs"><span class=hljs-comment >#RESIDUAL</span>
    a((u,ut,p),(v,q))       = ∫( v⋅ut + v⋅((∇(u)&#x27;)⋅u) + <span class=hljs-number >2</span>*ν*(ε(v)⊙ε(u)) - (∇⋅v)*p + q*(∇⋅u) )dΩ         <span class=hljs-comment ># Original transient NS</span>
    b((u,p),(v,q))          = ∫( v⊙(αu)+ v⊙(β((u⋅u).^(<span class=hljs-number >1</span>/<span class=hljs-number >2</span>))*u) )dΩveg                                 <span class=hljs-comment ># Darcy and forchheimer term</span>
                              ∫( v⊙(C_damp*u))dΩdampout                                               <span class=hljs-comment ># Sponge layer</span>
    c((u,p,η),(v,q,w))      = ∫( ( (-p_atm - g*η)*n_fa)⋅v )dΓ_fa                                       <span class=hljs-comment ># traction equilibrium air/downwards</span>
    d((u,η,ηt),(v,w))       = ∫( ( (u⋅n_z) - ηt)*w )dΓ_fa                                              <span class=hljs-comment ># traction equilibrium</span>
    l(v)                    = ∫( v⋅f_g )dΩ                                                             <span class=hljs-comment ># Gravity throughout domain</span>
    e(v,u,p)                = ∫( v⋅(hN) )dΓ_out                                                        <span class=hljs-comment ># &#x27;Outflow&#x27; pressure profile</span>
    tbt_oss((u,s),(v,ϵ))    = ∫( τₘ*((∇(u)&#x27;)⋅u - s)⋅( (∇(v)&#x27;)⋅u - ϵ ) )dΩ                               <span class=hljs-comment ># Stabilization projection term</span>

    res(t,((u,s,p,η),(ut,st,pt,ηt)),(v,ϵ,q,w)) = a((u,ut,p),(v,q)) + b((u,p),(v,q)) - l(v) + e(v,u,p) - c((u,p,η),(v,q,w)) + d((u,η,ηt),(v,w)) + tbt_oss((u,s),(v,ϵ))</code></pre> <h3 id=jacobian ><a href="#jacobian" class=header-anchor >Jacobian</a></h3> <p>Since Backtracking line search will be used in the solver, the derivative of the weak form is also needed; the jacobian:</p> <pre><code class="julia hljs">julia
    <span class=hljs-comment >#JACOBIAN</span>
    jac_a(u,(du,dp),(v,q))      = ∫( v⋅((∇(du)&#x27;)⋅u) + v⋅((∇(u)&#x27;)⋅du) + <span class=hljs-number >2</span>*ν*(ε(v)⊙ε(du)) - (∇⋅v)*dp + q*(∇⋅du))dΩ
    jac_b(u,du,v)               = ∫( v⊙(αdu) + (β*v⋅((<span class=hljs-number >1</span>/(nl_floor∘(u)))(u⊗u)⋅du + (u⋅u).^(<span class=hljs-number >1</span>/<span class=hljs-number >2</span>)*du)) )dΩveg +
                                  ∫( v⊙(C_damp*du)  )dΩdampout
    jac_c(dη,v)                 = ∫( ((-g*dη)*n_fa)⋅v )dΓ_fa
    jac_d(ηt,du,w)              = ∫( ( (du⋅n_z) - ηt)*w )dΓ_fa
    jac_tbt_oss(u,s,du,ds,v,ϵ)  = ∫( τₘ*( ((∇(v)&#x27;)⋅du)⋅((∇(u)&#x27;)⋅u - s) + (((∇(v)&#x27;)⋅u-ϵ)⋅((∇(u)&#x27;)⋅du +(∇(du)&#x27;)⋅u -ds)))
                                + (τlin∘(u,du))*(((∇(u)&#x27;)⋅u - s)⋅( (∇(v)&#x27;)⋅u - ϵ ) ))dΩ

    jac(t,((u,s,p,η),(ut,st,pt,ηt)),(du,ds,dp,dη),(v,ϵ,q,w))        = jac_a(u,(du,dp),(v,q))  + jac_b(u,du,v) + jac_c(dη,v) + jac_d(ηt,du,w) + jac_tbt_oss(u,s,du,ds,v,ϵ) <span class=hljs-comment >#+ ∫( v⋅(dp*n_Γout-2*ν*ε(du)⋅n_Γout) )dΓ_out</span>
    jac_t(t,((u,s,p,η),(ut,st,pt,ηt)),(dut,dst,dpt,dηt),(v,ϵ,q,w))  = ∫( v⋅dut )dΩ - ∫( dηt*w )dΓ_fa</code></pre> <p>The resulting system provides the operator:</p> <pre><code class="julia hljs">op = TransientFEOperator(res,jac,jac_t,X,Y)</code></pre>
<h3 id=initial_conditions ><a href="#initial_conditions" class=header-anchor >Initial conditions</a></h3>
<pre><code class="julia hljs"><span class=hljs-comment ># ###### Stokes operator</span>
    res_stokes((u,p),(v,q)) = ∫( <span class=hljs-number >2</span>*ν*(ε(v)⊙ε(u)) - (∇⋅v)*p + q*(∇⋅u) )dΩ
    jac_stokes((u,p),(du,dp),(v,q)) = res_stokes((du,dp),(v,q))
    op_stokes = FEOperator(res_stokes,jac_stokes,X(<span class=hljs-number >0.0</span>),Y(<span class=hljs-number >0.0</span>))
    <span class=hljs-comment >#global xh0 = solve(op_stokes)</span>
    xh0 = interpolate_everywhere([VectorValue(<span class=hljs-number >0.0</span>,<span class=hljs-number >0.0</span>),VectorValue(<span class=hljs-number >0.0</span>,<span class=hljs-number >0.0</span>),<span class=hljs-number >0.0</span>,<span class=hljs-number >0.0</span>],X(<span class=hljs-number >0.0</span>))
    <span class=hljs-comment >#xh0 = interpolate_everywhere([u₀(0.0),VectorValue(0.0,0.0),0.0,0.0],X(0.0))</span>
    <span class=hljs-comment >#writevtk(Ω,datadir(&quot;sims&quot;, &quot;$runname&quot;)*&quot;\\$runname _initial_up&quot;,cellfields=[&quot;u&quot;=&gt;xh0[1],&quot;p&quot;=&gt;xh0[2]])</span></code></pre>
<h2 id=solver ><a href="#solver" class=header-anchor >Solver</a></h2>
<pre><code class="julia hljs"><span class=hljs-comment ># ## Solver</span>
    ls = LinearSolvers.GmresSolver(verbose=<span class=hljs-literal >false</span>,preconditioner=ilu;τ=<span class=hljs-number >1e-6</span>)
    nl_solver = NLSolver(ls, show_trace = <span class=hljs-literal >true</span>,method = :newton,linesearch = BackTracking())
    
    <span class=hljs-comment >## Without preconditioning</span>
    <span class=hljs-comment ># nl_solver = NLSolver(show_trace = true,method = :newton,linesearch = BackTracking())</span>

    ode_scheme_1 = ThetaMethod(nl_solver, dt1, theta)
    solver_1 = TransientFESolver(ode_scheme_1)
    xh_1 = solve(solver_1, op, xh0, t0, T)
    
    pvd = paraview_collection(datadir(<span class=hljs-string >&quot;sims&quot;</span>, stage)*<span class=hljs-string >&quot;\\<span class=hljs-variable >$runname</span> collection_ups&quot;</span>, append=<span class=hljs-literal >false</span>)
    pvd_Γ = paraview_collection(datadir(<span class=hljs-string >&quot;sims&quot;</span>, stage)*<span class=hljs-string >&quot;\\<span class=hljs-variable >$runname</span> collection_eta&quot;</span>, append=<span class=hljs-literal >false</span>)

    <span class=hljs-keyword >for</span> (xh_tn, tn) <span class=hljs-keyword >in</span> xh_1
        uh, sh, ph, ηh = xh_tn
        t_doc = round(tn; digits=<span class=hljs-number >3</span>)
        pvd[tn] = createvtk(Ω, datadir(<span class=hljs-string >&quot;sims&quot;</span>,stage)*<span class=hljs-string >&quot;\\<span class=hljs-variable >$runname</span> FS<span class=hljs-variable >$t_doc</span>.vtu&quot;</span>, cellfields = [<span class=hljs-string >&quot;uh&quot;</span> =&gt; uh, <span class=hljs-string >&quot;ph&quot;</span> =&gt; ph, <span class=hljs-string >&quot;sh&quot;</span> =&gt; sh]) <span class=hljs-comment >#</span>
        pvd_Γ[tn] = createvtk(Γ_fa,datadir(<span class=hljs-string >&quot;sims&quot;</span>,stage)*<span class=hljs-string >&quot;\\<span class=hljs-variable >$runname</span> _FS_surf<span class=hljs-variable >$t_doc</span>.vtu&quot;</span>,cellfields = [<span class=hljs-string >&quot;etah&quot;</span> =&gt; ηh]) <span class=hljs-comment >#</span>
        <span class=hljs-comment ># global xh0</span>
        <span class=hljs-comment ># xh0 = xh_tn</span>
    <span class=hljs-keyword >end</span></code></pre>
<p>The code above will produce a solution that&#39;s immediately written to VTK files. By writing the solution to variable <code>xh0</code>, this can now be loaded as the intial conditions for a new solution.</p>
<p>Essentially this provides the option to first run a small timespan with large timesteps to provide a rough solution. The following run can then performed at higher temporal resolution, while it can skip the &#40;uninteresting&#41; initial start-up behaviour.</p>
<pre><code class="julia hljs">pvd = paraview_collection(datadir(<span class=hljs-string >&quot;sims&quot;</span>,stage)*<span class=hljs-string >&quot;\\collection_ups_<span class=hljs-subst >$(runname)</span>&quot;</span>, append=<span class=hljs-literal >false</span>)
    pvd_Γ = paraview_collection(datadir(<span class=hljs-string >&quot;sims&quot;</span>,stage)*<span class=hljs-string >&quot;\\collection_eta_<span class=hljs-subst >$(runname)</span>&quot;</span>, append=<span class=hljs-literal >false</span>)

    <span class=hljs-comment ># Same solver method, new inputs for Phase 2</span>
    ode_scheme_2 = ThetaMethod(nl_solver, dt2, theta)
    solver_2 = TransientFESolver(ode_scheme_2)
    xh_2 = solve(solver_2, op, xh0, t0_2, T_2)

    <span class=hljs-keyword >global</span> ηns = []
    <span class=hljs-keyword >global</span> uhs1 = []
    <span class=hljs-keyword >global</span> uhs2 = []
    <span class=hljs-keyword >global</span> uhs3 = []
    <span class=hljs-keyword >global</span> uhs4 = []
    <span class=hljs-keyword >global</span> phs = []
    <span class=hljs-keyword >for</span> (i, (xh, t)) <span class=hljs-keyword >in</span> enumerate(xh_2)
        uh, sh, ph, ηh = xh
    
        <span class=hljs-keyword >global</span> cell_values_ηn = get_cell_dof_values(ηh)
        surface = []
        len_FS = length(cell_values_ηn)
            <span class=hljs-keyword >for</span> j <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:len_FS
                push!(surface, cell_values_ηn[j][<span class=hljs-number >3</span>])
            <span class=hljs-keyword >end</span>
        push!(ηns, surface&#x27;)
    
        <span class=hljs-keyword >global</span> cell_values_uh = get_cell_dof_values(uh)
        surface_uh1 = []
        surface_uh2 = []
        surface_uh3 = []
        surface_uh4 =[]
        len_UH = length(cell_values_uh)
            <span class=hljs-keyword >for</span> j <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:len_UH
                push!(surface_uh1, cell_values_uh[j][<span class=hljs-number >1</span>])
                push!(surface_uh2, cell_values_uh[j][<span class=hljs-number >2</span>])
                push!(surface_uh3, cell_values_uh[j][<span class=hljs-number >3</span>])
                push!(surface_uh4, cell_values_uh[j][<span class=hljs-number >4</span>])
            <span class=hljs-keyword >end</span>
        push!(uhs1, surface_uh1&#x27;)
        push!(uhs2, surface_uh2&#x27;)
        push!(uhs3, surface_uh3&#x27;)
        push!(uhs4, surface_uh4&#x27;)
    
        <span class=hljs-keyword >global</span> cell_values_ph = get_cell_dof_values(ph)
        surface_ph = []
        len_pH = length(cell_values_ph)
            <span class=hljs-keyword >for</span> j <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:len_pH
                push!(surface_ph, cell_values_ph[j][<span class=hljs-number >1</span>])
            <span class=hljs-keyword >end</span>
        push!(phs, surface_ph&#x27;)
    
        t_doc = round(t; digits=<span class=hljs-number >4</span>)
        pvd[t] = createvtk(Ω, datadir(<span class=hljs-string >&quot;sims&quot;</span>,stage)*<span class=hljs-string >&quot;\\<span class=hljs-variable >$runname</span> _FS<span class=hljs-variable >$t_doc</span>.vtu&quot;</span>, cellfields = [<span class=hljs-string >&quot;uh&quot;</span> =&gt; uh, <span class=hljs-string >&quot;ph&quot;</span> =&gt; ph, <span class=hljs-string >&quot;sh&quot;</span> =&gt; sh])
        pvd_Γ[t] = createvtk(Γ_fa,datadir(<span class=hljs-string >&quot;sims&quot;</span>,stage)*<span class=hljs-string >&quot;\\<span class=hljs-variable >$runname</span> _FS_surf<span class=hljs-variable >$t_doc</span>.vtu&quot;</span>,cellfields = [<span class=hljs-string >&quot;etah&quot;</span> =&gt; ηh])
    <span class=hljs-keyword >end</span>
    
    vtk_save(pvd)
    vtk_save(pvd_Γ)</code></pre>
<p>We now have the desired solution as variable <code>xh</code>, as timeseries in the variables <code>ηns, uhs1, uhs2, uhs3, uhs4</code> and <code>phs</code>, and as the saved VTK files. To be able to process the solution at a later moment as wel, JLD2 files are created. Native julia datafiles that allow for storing the generated solution. To this end, the arrays are written into a library that is then saved in the <code>.jld2</code> format. </p>
<pre><code class="julia hljs"><span class=hljs-meta >@timeit</span> timesave <span class=hljs-string >&quot;Data build &amp; save&quot;</span> <span class=hljs-keyword >begin</span>
    
    dat_total = <span class=hljs-built_in >Dict</span>()
    dat_total[<span class=hljs-string >&quot;eta&quot;</span>] = ηns
    dat_total[<span class=hljs-string >&quot;uh1&quot;</span>] = uhs1
    dat_total[<span class=hljs-string >&quot;uh2&quot;</span>] = uhs2
    dat_total[<span class=hljs-string >&quot;uh3&quot;</span>] = uhs3
    dat_total[<span class=hljs-string >&quot;uh4&quot;</span>] = uhs4
    dat_total[<span class=hljs-string >&quot;ph&quot;</span>] = phs
    dat_params = <span class=hljs-built_in >Dict</span>(
        <span class=hljs-string >&quot;stage&quot;</span> =&gt; [stage],
        <span class=hljs-string >&quot;runname&quot;</span> =&gt; [runname],
        <span class=hljs-string >&quot;rundate&quot;</span> =&gt; [start_time],
        <span class=hljs-string >&quot;Lwave&quot;</span>=&gt; [λ_in],
        <span class=hljs-string >&quot;dt1&quot;</span>=&gt; [ dt1],
        <span class=hljs-string >&quot;t0&quot;</span> =&gt; [ t0],
        <span class=hljs-string >&quot;T&quot;</span>  =&gt; [T],
        <span class=hljs-string >&quot;dt2&quot;</span> =&gt; [dt2],
        <span class=hljs-string >&quot;t0_2&quot;</span>  =&gt; [t0_2],
        <span class=hljs-string >&quot;T_2&quot;</span>  =&gt; [T_2],
        <span class=hljs-string >&quot;a_in&quot;</span> =&gt; [ a_in],
        <span class=hljs-string >&quot;T_in&quot;</span> =&gt; [ T_in],
        <span class=hljs-string >&quot;theta_in&quot;</span> =&gt; [theta_in],
        <span class=hljs-string >&quot;a_cons&quot;</span> =&gt; [a_cons],
        <span class=hljs-string >&quot;b_cons&quot;</span> =&gt; [b_cons],
        <span class=hljs-string >&quot;C1&quot;</span> =&gt; [ C1],
        <span class=hljs-string >&quot;cellm&quot;</span>  =&gt; [cellm],
        <span class=hljs-string >&quot;length_tank&quot;</span>  =&gt; [length_tank],
        <span class=hljs-string >&quot;depth_tank&quot;</span>  =&gt; [depth_tank],
        <span class=hljs-string >&quot;length_damp&quot;</span> =&gt; [length_damp], 
        <span class=hljs-string >&quot;vegtop&quot;</span> =&gt; [vegtop], 
        <span class=hljs-string >&quot;vegbottom&quot;</span> =&gt; [vegbottom],
        <span class=hljs-string >&quot;vegheight&quot;</span> =&gt; [vegheight], 
        <span class=hljs-string >&quot;vegfront&quot;</span> =&gt; [vegfront], 
        <span class=hljs-string >&quot;vegback&quot;</span> =&gt; [vegback], 
        <span class=hljs-string >&quot;veglength&quot;</span>=&gt;[veglength]
        )
    dat_total[<span class=hljs-string >&quot;params&quot;</span>] = dat_params

    save(datadir(<span class=hljs-string >&quot;data&quot;</span>,stage)*<span class=hljs-string >&quot;\\<span class=hljs-subst >$(runname)</span>.jld2&quot;</span>,dat_total)

    println(<span class=hljs-string >&quot;Starttime was: <span class=hljs-subst >$(start_time)</span>, current time is &quot;</span>, Dates.format(Dates.now(),<span class=hljs-string >&quot;HH_MM_SS&quot;</span>))
    <span class=hljs-keyword >return</span> <span class=hljs-literal >true</span>
<span class=hljs-keyword >end</span>
<span class=hljs-keyword >end</span></code></pre>
<h2 id=plotting ><a href="#plotting" class=header-anchor >Plotting</a></h2>
<p>Julia has many options for graphically presenting results. Most are julia-versions of software you may have used before &#40;think matplotlib&#41;. <a href="http://docs.juliaplots.org/latest/">Plots</a> is a visualization interface and toolset. It sits above other backends, like GR, PyPlot, PGFPlotsX, or Plotly.</p>
<p>For the numerical model, a series of functions was defined to plot various insights. An indication of the core functions is provided here.</p>
<pre><code class="julia hljs"><span class=hljs-keyword >using</span> Plots; gr()
<span class=hljs-keyword >function</span> plot_wave(loadedruns,region,starttime,saveorshow,plotaddition)
    <span class=hljs-keyword >global</span> params1 = loadedruns[<span class=hljs-number >1</span>]
    plotname = <span class=hljs-string >&quot;Damping_<span class=hljs-subst >$(plotaddition)</span>&quot;</span>
    titlename = <span class=hljs-string >&quot;Reproduction - Zhu et al. (2021), waveAT015T2&quot;</span>
    xaxisname = <span class=hljs-string >&quot;Normalized distance into vegetation (x-Lₛ)/Lᵥ&quot;</span>
    yaxisname = <span class=hljs-string >&quot;Normalized Wave height η/η₀&quot;</span>
    yaxisname = <span class=hljs-string >&quot;Wave height η [m]&quot;</span>
    labelsname = [<span class=hljs-string >&quot;Hs = 1.5 m ,T = 6 s, α = <span class=hljs-subst >$(params1[<span class=hljs-string >&quot;params&quot;</span>][<span class=hljs-string >&quot;a_cons&quot;</span>][<span class=hljs-number >1</span>])</span>&quot;</span>]<span class=hljs-comment >#, β = $(params1[&quot;params&quot;][&quot;b_cons&quot;][1])&quot;]#,&quot;T = $(params2[&quot;params&quot;][&quot;T_in&quot;][1]), a = $(params2[&quot;params&quot;][&quot;a_cons&quot;][1]), b = $(params2[&quot;params&quot;][&quot;b_cons&quot;][1])&quot;,&quot;T = $(params3[&quot;params&quot;][&quot;T_in&quot;][1]), a = $(params3[&quot;params&quot;][&quot;a_cons&quot;][1]), b = $(params3[&quot;params&quot;][&quot;b_cons&quot;][1])&quot;,</span>
    labelsname = [<span class=hljs-string >&quot;a_in = <span class=hljs-subst >$(params1[<span class=hljs-string >&quot;params&quot;</span>][<span class=hljs-string >&quot;a_in&quot;</span>][<span class=hljs-number >1</span>])</span>,T = <span class=hljs-subst >$(params1[<span class=hljs-string >&quot;params&quot;</span>][<span class=hljs-string >&quot;T_in&quot;</span>][<span class=hljs-number >1</span>])</span>, α = <span class=hljs-subst >$(params1[<span class=hljs-string >&quot;params&quot;</span>][<span class=hljs-string >&quot;a_cons&quot;</span>][<span class=hljs-number >1</span>])</span>, β = <span class=hljs-subst >$(params1[<span class=hljs-string >&quot;params&quot;</span>][<span class=hljs-string >&quot;b_cons&quot;</span>][<span class=hljs-number >1</span>])</span>&quot;</span>]<span class=hljs-comment >#,&quot;T = $(params2[&quot;params&quot;][&quot;T_in&quot;][1]), a = $(params2[&quot;params&quot;][&quot;a_cons&quot;][1]), b = $(params2[&quot;params&quot;][&quot;b_cons&quot;][1])&quot;,&quot;T = $(params3[&quot;params&quot;][&quot;T_in&quot;][1]), a = $(params3[&quot;params&quot;][&quot;a_cons&quot;][1]), b = $(params3[&quot;params&quot;][&quot;b_cons&quot;][1])&quot;,</span>
    <span class=hljs-keyword >global</span> max_at_coord1 = []
    
    <span class=hljs-keyword >global</span> finalcell = []
    <span class=hljs-keyword >global</span> cellm_list = []
    <span class=hljs-keyword >global</span> cphase = (params1[<span class=hljs-string >&quot;params&quot;</span>][<span class=hljs-string >&quot;Lwave&quot;</span>][<span class=hljs-number >1</span>]/params1[<span class=hljs-string >&quot;params&quot;</span>][<span class=hljs-string >&quot;T_in&quot;</span>][<span class=hljs-number >1</span>])</code></pre>
<pre><code class="julia hljs"><span class=hljs-keyword >if</span> starttime ==<span class=hljs-number >1000</span>
        temp_time = <span class=hljs-number >2</span>*trunc(<span class=hljs-built_in >Int</span>,params1[<span class=hljs-string >&quot;params&quot;</span>][<span class=hljs-string >&quot;length_tank&quot;</span>][<span class=hljs-number >1</span>]/cphase)
        <span class=hljs-keyword >if</span> temp_time &gt;= params1[<span class=hljs-string >&quot;params&quot;</span>][<span class=hljs-string >&quot;T_2&quot;</span>][<span class=hljs-number >1</span>]
            println(<span class=hljs-string >&quot;initial wave travelling time is <span class=hljs-subst >$(temp_time)</span>s, choosing last 2s of simulation&quot;</span>)
            <span class=hljs-keyword >global</span> start_time = <span class=hljs-number >2</span>*trunc(<span class=hljs-built_in >Int</span>,params1[<span class=hljs-string >&quot;params&quot;</span>][<span class=hljs-string >&quot;length_tank&quot;</span>][<span class=hljs-number >1</span>]/cphase)-<span class=hljs-number >1</span>
        <span class=hljs-keyword >else</span>
        <span class=hljs-keyword >global</span> start_time = <span class=hljs-number >2</span>*trunc(<span class=hljs-built_in >Int</span>,params1[<span class=hljs-string >&quot;params&quot;</span>][<span class=hljs-string >&quot;length_tank&quot;</span>][<span class=hljs-number >1</span>]/cphase)
        println(<span class=hljs-string >&quot;No measurement starttime inserted: using c=<span class=hljs-subst >$(cphase)</span>m/s -&gt; t=<span class=hljs-subst >$(start_time)</span>&quot;</span>)
        <span class=hljs-keyword >end</span>
    <span class=hljs-keyword >elseif</span> starttime ==<span class=hljs-number >0</span>
        <span class=hljs-keyword >global</span> start_time = <span class=hljs-number >1</span>
    <span class=hljs-keyword >else</span>
        <span class=hljs-keyword >global</span> start_time = starttime
    <span class=hljs-keyword >end</span>

    <span class=hljs-keyword >if</span> length(params1) == <span class=hljs-number >0</span>
        println(<span class=hljs-string >&quot;no data loaded yet, commencing now&quot;</span>)
        <span class=hljs-keyword >global</span> params1 = load(datadir(<span class=hljs-string >&quot;data&quot;</span>,foldername,runs[<span class=hljs-number >1</span>]))
        <span class=hljs-comment ># global xcoord_cell = trunc(Int,(params1[&quot;params&quot;][&quot;vegfront&quot;][1]+params1[&quot;params&quot;][&quot;veglength&quot;][1])*params1[&quot;params&quot;][&quot;cellm&quot;][1])</span>
    <span class=hljs-keyword >else</span>
        println(<span class=hljs-string >&quot;data already loaded, skipping step&quot;</span>)
    <span class=hljs-keyword >end</span>
        println(<span class=hljs-string >&quot;Houston, we have data&quot;</span>)
   
        <span class=hljs-comment ># for i in 1:length(runs)</span>
        <span class=hljs-comment ># global run_dict = load(datadir(&quot;data&quot;,foldername,runs[i]))</span>
        <span class=hljs-comment ># icellm = run_dict[&quot;params&quot;][&quot;cellm&quot;][1]</span>
        <span class=hljs-comment ># push!(cellm_list, icellm)</span>
        <span class=hljs-comment ># ifinalcell = run_dict[&quot;params&quot;][&quot;length_tank&quot;][1]*icellm</span>
        <span class=hljs-comment ># push!(finalcell, ifinalcell)</span></code></pre>
<p>Depending on what type of plot is desired, the entire domain, or just part of it can be shown.</p>
<pre><code class="julia hljs"><span class=hljs-keyword >if</span> region == <span class=hljs-string >&quot;veg&quot;</span>
        startcell = trunc(<span class=hljs-built_in >Int</span>,params1[<span class=hljs-string >&quot;params&quot;</span>][<span class=hljs-string >&quot;vegfront&quot;</span>][<span class=hljs-number >1</span>]*params1[<span class=hljs-string >&quot;params&quot;</span>][<span class=hljs-string >&quot;cellm&quot;</span>][<span class=hljs-number >1</span>])
        endcell = trunc(<span class=hljs-built_in >Int</span>,startcell + params1[<span class=hljs-string >&quot;params&quot;</span>][<span class=hljs-string >&quot;veglength&quot;</span>][<span class=hljs-number >1</span>]*params1[<span class=hljs-string >&quot;params&quot;</span>][<span class=hljs-string >&quot;cellm&quot;</span>][<span class=hljs-number >1</span>])
        totalcells = endcell-startcell        
        EDRfirstcell = startcell
        EDRlastcell = totalcells
        x_axis = <span class=hljs-built_in >LinRange</span>(params1[<span class=hljs-string >&quot;params&quot;</span>][<span class=hljs-string >&quot;vegfront&quot;</span>][<span class=hljs-number >1</span>], (params1[<span class=hljs-string >&quot;params&quot;</span>][<span class=hljs-string >&quot;vegfront&quot;</span>][<span class=hljs-number >1</span>]+ params1[<span class=hljs-string >&quot;params&quot;</span>][<span class=hljs-string >&quot;veglength&quot;</span>][<span class=hljs-number >1</span>]), totalcells)
        k=<span class=hljs-number >1</span>
        xaxisname = <span class=hljs-string >&quot;Normalized distance into vegetation (x-Lₛ)/Lᵥ&quot;</span>

    <span class=hljs-keyword >elseif</span> region == <span class=hljs-string >&quot;domain&quot;</span>
        startcell = <span class=hljs-number >3</span> <span class=hljs-comment >#was1</span>
        endcell = trunc(<span class=hljs-built_in >Int</span>,params1[<span class=hljs-string >&quot;params&quot;</span>][<span class=hljs-string >&quot;length_tank&quot;</span>][<span class=hljs-number >1</span>]*params1[<span class=hljs-string >&quot;params&quot;</span>][<span class=hljs-string >&quot;cellm&quot;</span>][<span class=hljs-number >1</span>])
        EDRfirstcell = trunc(<span class=hljs-built_in >Int</span>, params1[<span class=hljs-string >&quot;params&quot;</span>][<span class=hljs-string >&quot;vegfront&quot;</span>][<span class=hljs-number >1</span>]*params1[<span class=hljs-string >&quot;params&quot;</span>][<span class=hljs-string >&quot;cellm&quot;</span>][<span class=hljs-number >1</span>])
        EDRlastcell = EDRfirstcell + trunc(<span class=hljs-built_in >Int</span>,(params1[<span class=hljs-string >&quot;params&quot;</span>][<span class=hljs-string >&quot;veglength&quot;</span>][<span class=hljs-number >1</span>]*params1[<span class=hljs-string >&quot;params&quot;</span>][<span class=hljs-string >&quot;cellm&quot;</span>][<span class=hljs-number >1</span>]))
        totalcells = endcell-startcell
        x_axis = <span class=hljs-built_in >LinRange</span>(<span class=hljs-number >0</span>,params1[<span class=hljs-string >&quot;params&quot;</span>][<span class=hljs-string >&quot;length_tank&quot;</span>][<span class=hljs-number >1</span>],totalcells)
        <span class=hljs-comment ># x_axis = LinRange(0,750,totalcells)</span>

        k=<span class=hljs-number >4</span>
        xaxisname = <span class=hljs-string >&quot;Distance into domain [m]&quot;</span>

    <span class=hljs-keyword >else</span> 
        printlnln(<span class=hljs-string >&quot;No region selected&quot;</span>)
    <span class=hljs-keyword >end</span></code></pre>
<p>Next up is looping through the timesteps to build the arrays that will be plotted eventually.</p>
<pre><code class="julia hljs"><span class=hljs-keyword >for</span> j <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:totalcells
            <span class=hljs-keyword >global</span> timeseries = []
            <span class=hljs-keyword >for</span> ts <span class=hljs-keyword >in</span> trunc(<span class=hljs-built_in >Int</span>,(start_time)/params1[<span class=hljs-string >&quot;params&quot;</span>][<span class=hljs-string >&quot;dt2&quot;</span>][<span class=hljs-number >1</span>]):(trunc(<span class=hljs-built_in >Int</span>,(params1[<span class=hljs-string >&quot;params&quot;</span>][<span class=hljs-string >&quot;T_2&quot;</span>][<span class=hljs-number >1</span>])/params1[<span class=hljs-string >&quot;params&quot;</span>][<span class=hljs-string >&quot;dt2&quot;</span>][<span class=hljs-number >1</span>])-<span class=hljs-number >1</span>)
                temp_val = params1[<span class=hljs-string >&quot;eta&quot;</span>][ts][j+startcell]
                push!(timeseries, temp_val&#x27;)
            <span class=hljs-keyword >end</span>
            temp_max_at_coord = maximum(timeseries)
                push!(max_at_coord1, temp_max_at_coord)
        <span class=hljs-keyword >end</span>
    <span class=hljs-comment ># end</span>

    norm_run1 = (max_at_coord1/max_at_coord1[k])
    
    <span class=hljs-comment >#If desired, a linear fit can be added:</span>
    linearizedfit, coef1, coef2 = poly_fit(x_axis[EDRfirstcell:EDRlastcell],max_at_coord1[EDRfirstcell:EDRlastcell])
    coefn1, coefn2 = [coef1, coef2] ./ max_at_coord1[k]
    linearizedfitnorm = linearizedfit/max_at_coord1[k]
    
    MP1, MP2 = x_axis[EDRlastcell], linearizedfitnorm[EDRlastcell-EDRfirstcell]
    perc1 = round((<span class=hljs-number >1</span>-(linearizedfit[EDRlastcell-EDRfirstcell]/max_at_coord1[k])^<span class=hljs-number >2</span>)*<span class=hljs-number >100</span>, digits = <span class=hljs-number >1</span>)
    HTRend = round(linearizedfit[EDRlastcell-EDRfirstcell]/max_at_coord1[k], digits = <span class=hljs-number >2</span>)
    <span class=hljs-comment ># lenslo = 0.95*minimum([norm_run1[end], norm_run2[end], norm_run3[end], norm_run5[end], norm_run5[end], norm_run6[end]])#, norm_run4[end]])</span>
    <span class=hljs-comment ># lenshi = 1.05*maximum([norm_run1[end], norm_run2[end], norm_run3[end], norm_run5[end], norm_run5[end], norm_run6[end]])#, norm_run4[end]])</span>
    <span class=hljs-comment ># lensleft = 7.5/8</span>
    <span class=hljs-comment ># lensright = 1</span>
    <span class=hljs-comment ># xlens = 0.4</span>
    <span class=hljs-comment ># ylens = 0.3</span>
    <span class=hljs-comment ># lenswidth = 0.2</span>
    <span class=hljs-comment ># lensheight = 0.35</span>

    <span class=hljs-keyword >global</span> labels = labelsname    
    <span class=hljs-keyword >global</span> p_total1 = plot(x_axis, norm_run1, label = labels[<span class=hljs-number >1</span>], dpi=<span class=hljs-number >200</span>, legend = :bottomleft, ylim=(<span class=hljs-number >0</span>,<span class=hljs-number >1.3</span>))
    <span class=hljs-comment ># plot!(x_axis[EDRfirstcell:EDRlastcell], linearizedfitnorm, ls=:dash, label=&quot;linear fit, lsq ($(trunc(coefn1,digits=3)) + $(trunc(coefn2, digits=3))x)&quot;)</span>
    scatter!(xpoint_exp_wave, values_exp_wave, label = <span class=hljs-string >&quot;Data Hu et al. (2014)&quot;</span>)
    scatter!([MP1], [MP2], markershape=:star5, color=:grey, alpha=<span class=hljs-number >0.5</span>, label = <span class=hljs-string >&quot;HTR = <span class=hljs-subst >$(HTRend)</span>, EDR = <span class=hljs-subst >$(perc1)</span> %&quot;</span>)
    xlabel!(p_total1,xaxisname)
    ylabel!(p_total1, yaxisname)
    title!(p_total1, titlename)
    <span class=hljs-comment ># lens!([lensleft,lensright], [lenslo, lenshi], inset = (1, bbox(xlens, ylens, lenswidth, lensheight)), xticks = false, framestyle=:box, ls=:dash, lc=:grey, subplot = 2)#,xticks=1:2:2, subplot=1)</span>

    <span class=hljs-keyword >if</span> saveorshow == <span class=hljs-string >&quot;save&quot;</span>
        savefig(p_total1, plotsdir(<span class=hljs-string >&quot;<span class=hljs-subst >$(plotname)</span>.png&quot;</span>))       
        println(<span class=hljs-string >&quot;figure saved as <span class=hljs-subst >$( plotsdir(<span class=hljs-string >&quot;<span class=hljs-subst >$(plotname)</span>.png&quot;</span>)</span>)&quot;</span>)
    <span class=hljs-keyword >elseif</span> saveorshow == <span class=hljs-string >&quot;show&quot;</span>
        println(<span class=hljs-string >&quot;not saved&quot;</span>)
    <span class=hljs-keyword >else</span>
        println(<span class=hljs-string >&quot;please define show or save&quot;</span>)
    <span class=hljs-keyword >end</span>
    p_total1
<span class=hljs-keyword >end</span></code></pre>
<h3 id=fitting_a_polynomial ><a href="#fitting_a_polynomial" class=header-anchor >Fitting a polynomial</a></h3>
<p>For the analysis of data and for further development of the framework, it is useful to be able to fit user-specified function types to the simulation data. This can be done using many packages, <a href="https://julianlsolvers.github.io/LsqFit.jl/latest/tutorial/">LsqFit</a> is one convenient option.</p>
<pre><code class="julia hljs"><span class=hljs-keyword >using</span> Polynomials
<span class=hljs-keyword >using</span> LsqFit
<span class=hljs-keyword >function</span> poly_fit(xdata,ydata)

    p0 = [<span class=hljs-number >0.1</span>, <span class=hljs-number >0.1</span>]
    model(t,p)= p[<span class=hljs-number >1</span>] .+ p[<span class=hljs-number >2</span>]*t
    xlin = range(xdata[<span class=hljs-number >1</span>], xdata[<span class=hljs-keyword >end</span>], length =<span class=hljs-number >100</span>)

    fitcurve = curve_fit(model, xdata, ydata, p0)
    residuals = fitcurve.resid

    <span class=hljs-keyword >global</span> linydata = ydata .+ residuals
    param = fitcurve.param
    println(<span class=hljs-string >&quot;<span class=hljs-subst >$(param)</span>&quot;</span>)

    <span class=hljs-keyword >return</span> linydata, param[<span class=hljs-number >1</span>], param[<span class=hljs-number >2</span>]
<span class=hljs-keyword >end</span></code></pre>
<img style="display: block;max-width: 100%;height: auto;margin: auto;float: none!important;" src="/GridapOffshore.jl/Fluids\Porous/img/Results_Hdomain.png" alt="Domain model" width="75%" /><center><i>Structure of framework components</i></center>
<h1 id=workflow_tools ><a href="#workflow_tools" class=header-anchor >Workflow tools</a></h1>
<p>To structure the work around setting up a model, running simulations, analysing data and collaborating on code through Github, the following tools are recommended.</p>
<h2 id=research_project_structuring ><a href="#research_project_structuring" class=header-anchor >Research project structuring</a></h2>
<p>The package <a href="https://juliadynamics.github.io/DrWatson.jl/dev/">DrWatson.jl</a> automatically creates a folder-structure/repository that includes everything you need to develop code in a research project and allows for collaboration through GitHub easily. The set-up includes infrastructure dedicated to ignore some folders during commits to avoid overloading your repo. It lets anyone duplicate all package versions and dependencies for reproducing your work without running into errors. Furthermore, provide clear naming conventions and prevent double work by checking whether the same input parameters have already been used in an earlier run.</p>
<p>It is worth checking out and investing a little bit of time in beforehand, as it will make your life significantly easier.</p>
<pre><code class="julia hljs"><span class=hljs-keyword >using</span> DrWatson
<span class=hljs-meta >@quickactivate</span> <span class=hljs-string >&quot;PorousMediumFlow&quot;</span> <span class=hljs-comment ># defines what environment (ie. versions etc) is activated</span>
include(projectdir(<span class=hljs-string >&quot;src&quot;</span>,<span class=hljs-string >&quot;Sim_PM.jl&quot;</span>)) <span class=hljs-comment >#projectdir() is an example of DrWatson&#x27;s helpful tools</span></code></pre>
<h2 id=simulating_in_batches ><a href="#simulating_in_batches" class=header-anchor >Simulating in batches</a></h2>
<p>With simulations that take more than a couple of seconds, automation is your friend. DrWatson allows to setup a library of input parameters that are fed into the simulation script when the last run is done.</p>
<pre><code class="julia hljs">allparams = <span class=hljs-built_in >Dict</span>(
    <span class=hljs-string >&quot;stage&quot;</span>=&gt;[<span class=hljs-string >&quot;numerical_methods&quot;</span>],
    <span class=hljs-string >&quot;dt1&quot;</span>=&gt; [ <span class=hljs-number >0.005</span>],   <span class=hljs-comment >#timestep of first solving round</span>
    <span class=hljs-string >&quot;t0&quot;</span> =&gt; [ <span class=hljs-number >0.0</span>],     <span class=hljs-comment >#starttime of first solving round</span>
    <span class=hljs-string >&quot;T&quot;</span>  =&gt; [ <span class=hljs-number >0.01</span>],    <span class=hljs-comment >#end time of first solving round</span>

    <span class=hljs-string >&quot;dt2&quot;</span> =&gt; [<span class=hljs-number >0.01</span>],
    <span class=hljs-string >&quot;t0_2&quot;</span>  =&gt; [<span class=hljs-number >0.01</span>],
    <span class=hljs-string >&quot;T_2&quot;</span>  =&gt; [<span class=hljs-number >5.0</span>], <span class=hljs-comment >#30</span>

    <span class=hljs-string >&quot;a_in&quot;</span> =&gt; [<span class=hljs-number >0.015</span>, <span class=hljs-number >0.01</span>],  <span class=hljs-comment >#m 0.05</span>
    <span class=hljs-string >&quot;T_in&quot;</span> =&gt; [<span class=hljs-number >1.0</span>],
    
    <span class=hljs-string >&quot;a_cons&quot;</span> =&gt; [ <span class=hljs-number >0.15</span> <span class=hljs-number >0.2</span>, <span class=hljs-number >0.1</span>, <span class=hljs-number >0.05</span>],
    <span class=hljs-string >&quot;b_cons&quot;</span> =&gt; [ <span class=hljs-number >5.0</span>],
    <span class=hljs-string >&quot;C1&quot;</span> =&gt; [ <span class=hljs-number >7.5</span>],

    <span class=hljs-string >&quot;cellm&quot;</span>  =&gt; [<span class=hljs-number >5.0</span>],
    <span class=hljs-string >&quot;length_tank&quot;</span>  =&gt; [<span class=hljs-number >15.0</span>],
    <span class=hljs-string >&quot;depth_tank&quot;</span>  =&gt; [<span class=hljs-number >1.0</span>],
    <span class=hljs-string >&quot;length_damp&quot;</span> =&gt; [<span class=hljs-number >7.0</span>], 
    <span class=hljs-string >&quot;vegtop&quot;</span> =&gt; [<span class=hljs-number >1.0</span>], 
    <span class=hljs-string >&quot;vegheight&quot;</span> =&gt; [<span class=hljs-number >0.1</span>], 
    <span class=hljs-string >&quot;vegfront&quot;</span> =&gt; [<span class=hljs-number >1.0</span>], 
    <span class=hljs-string >&quot;veglength&quot;</span> =&gt; [<span class=hljs-number >6.0</span>]
)
dicts = dict_list(allparams)</code></pre>
<p>We have now set up the dictionary that contains all variables we desire for input. We run <code>sim_prep&#40;d:Dict&#41;</code> to build a series of <em>all</em> combinations of these variables. </p>
<div class=colbox-blue ><p>⚠ <b>Warning:</b>      </p>
<p>For the large number of input variables of this model, the possible combinations grow quickly. Make sure to carefully think about what runs &#40;and combinations&#41; are essential.</p></div>
<pre><code class="julia hljs"><span class=hljs-keyword >function</span> sim_prep(d::<span class=hljs-built_in >Dict</span>)
    <span class=hljs-meta >@unpack</span> stage, dt1, t0, T, dt2, t0_2, T_2, a_in, T_in, theta_in a_cons, b_cons, C1, cellm, length_tank, depth_tank, length_damp, vegtop, vegheight, vegfront, veglength = d
    etahs = sim_run(stage, dt1, t0, T, dt2, t0_2, T_2, a_in, T_in, theta_in, a_cons, b_cons, C1, cellm, length_tank, depth_tank, length_damp, vegtop, vegheight, vegfront, veglength)
    <span class=hljs-keyword >return</span> <span class=hljs-literal >true</span>
<span class=hljs-keyword >end</span>

<span class=hljs-keyword >for</span> (i, d) <span class=hljs-keyword >in</span> enumerate(dicts)
    f1 = sim_prep(d)
<span class=hljs-keyword >end</span></code></pre>
<p>The julia file that runs the simulations can then make used of the created dictionaries of input parameters:</p>
<pre><code class="julia hljs"><span class=hljs-keyword >function</span> sim_run(stage, dt1, t0, T, dt2, t0_2, T_2, a_in, T_in, theta_in, a_cons, b_cons, C1, cellm, length_tank, depth_tank, length_damp, vegtop, vegheight, vegfront, veglength)
    <span class=hljs-comment >######################</span>
    <span class=hljs-comment ># Actual simulations #</span>
    <span class=hljs-comment >######################</span>
<span class=hljs-keyword >end</span></code></pre>
<h2 id=timing_outputs ><a href="#timing_outputs" class=header-anchor >Timing outputs</a></h2>
<p><a href="https://github.com/KristofferC/TimerOutputs.jl">TimerOutputs.jl</a> is a minimal, basic tool that helps to gain some insights into the resources your simulations demands.</p>
<pre><code class="julia hljs"><span class=hljs-keyword >using</span> TimerOutputs

timesave = TimerOutput()
<span class=hljs-meta >@timeit</span> timesave <span class=hljs-string >&quot;Total simulation time&quot;</span> <span class=hljs-keyword >begin</span>

    <span class=hljs-comment >####################################</span>
    <span class=hljs-comment ># Setting up a batch of simulation #</span>
    <span class=hljs-comment >####################################</span>

    <span class=hljs-meta >@timeit</span> timesave <span class=hljs-string >&quot;Simulation time 1 run&quot;</span> <span class=hljs-keyword >begin</span>

        <span class=hljs-comment >######################</span>
        <span class=hljs-comment ># Actual simulations #</span>
        <span class=hljs-comment >######################</span>

    <span class=hljs-keyword >end</span>
<span class=hljs-keyword >end</span>
show(timesave)</code></pre>
<p>The image below provides an example of what the results look like when a .jl uses multiple timers throughout:</p>
<img style="display: block;max-width: 100%;height: auto;margin: auto;float: none!important;" src="/GridapOffshore.jl/Fluids\Porous/img/base_run.png" alt="TimerOutputs summary" width="100%" /><center><i>TimerOutputs summary</i></center>
<div class=page-foot >
  <div class=copyright >
    &copy; Oriol Colomés. Last modified: January 17, 2024. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
  </div>
</div>
</div>
  </main> 
  <script src="/GridapOffshore.jl/libs/vela/metisMenu.min.js"></script>
  <script src="/GridapOffshore.jl/libs/vela/slideout.min.js"></script>